_format_version: "3.0"
_transform: true

services:
  - name: athena-auth
    url: http://athena-java-service:8080
    routes:
      - name: auth-route
        paths:
          - /api/auth
        strip_path: false

  - name: athena-credit-api
    url: http://athena-python-service:8001
    routes:
      - name: credit-score-route
        paths:
          - /api/v1/credit-score
          - /api/v1/credit-report
        strip_path: false
    plugins:
      - name: jwt
        config:
          key_claim_name: sub
          claims_to_verify:
            - exp
      - name: rate-limiting
        config:
          minute: 100
          policy: local

  - name: athena-crb-service
    url: http://athena-java-service:8080
    routes:
      - name: crb-route
        paths:
          - /api/v1/crb
        strip_path: false
    plugins:
      - name: jwt
        config:
          key_claim_name: sub
          claims_to_verify:
            - exp

  - name: athena-inbound-reports
    url: http://athena-python-service:8001
    routes:
      - name: inbound-reports-route
        paths:
          - /api/v1/credit-reports
        strip_path: false
    plugins:
      - name: key-auth
        config:
          key_names:
            - X-Api-Key

  - name: athena-thirdparty
    url: http://athena-java-service:8080
    routes:
      - name: thirdparty-route
        paths:
          - /api/v3p
        strip_path: false
    plugins:
      - name: key-auth
        config:
          key_names:
            - X-Api-Key
      - name: rate-limiting
        config:
          hour: 1000
          policy: local
      - name: file-log
        config:
          path: /tmp/kong-access.log

consumers:
  - username: dev-partner
    keyauth_credentials:
      - key: dev-key
